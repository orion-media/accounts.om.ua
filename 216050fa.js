Object.defineProperty(Object.prototype,"getProperty",{value:function(e){if(""===e)return this;let t,o=this,r=e.toString().split("."),s=r.length;for(t=0;t<s;t++){if(void 0===o[r[t]])return;o=o[r[t]]}return o}}),Object.defineProperty(Object.prototype,"setProperty",{value:function(e,t){let o,r=this,s=e.toString().split("."),i=s.length;for(o=0;o<i-1;o++)void 0===r[s[o]]&&(r[s[o]]={}),r=r[s[o]];r[s[i-1]]=t}}),Object.defineProperty(Object.prototype,"deleteProperty",{value:function(e){let t=this,o=e.toString().split(".");o.length>1&&(e=o[o.length-1],t=this.getProperty(o.slice(0,-1).join("."))),void 0!==t&&void 0!==t[e]&&delete t[e]}});var om={prefix:"",toastDelay:5e3,toastPosition:"bottom right",langs:{ru:{signup_in_progress:"Выполняется регистрация...",signin_in_progress:"Выполняется вход...",signin_success:"Вход успешно выполнен от имени",signout_in_progress:"Выполняется выход...",signout_success:"Выход выполнен успешно",saving:"Сохранение...",saved:"Сохранено"}},codes:{0:"Успешно",1:"Внутренняя ошибка",2:"Доступ запрещен",100:"Отсутствует обязательный параметр",200:"Адрес электронной почты уже зарегистрирован",201:"Имя пользователя уже зарегистрировано",300:"Неправильный пароль",400:"Имя пользователя или адрес электронной почты не найден",401:"Сессия не найдена",500:"Некорректный адрес электронной почты",501:"Некорректное имя пользователя",502:"Некорректный пароль",503:"Некорректное имя пользователя или адрес электронной почты",504:"Некорректный идентификатор сессии"},sha:async e=>{let t=new TextEncoder("utf-8").encode(e);return t=await crypto.subtle.digest("sha-512",t),(t=Array.from(new Uint8Array(t))).map(e=>("00"+e.toString(16)).slice(-2)).join("")},random:e=>{let t=new Uint8Array(e||1);return crypto.getRandomValues(t),(t=Array.from(t)).map(e=>("00"+e.toString(16)).slice(-2)).join("")},getLocal:(e,t)=>{e=om.prefix+e;let o=localStorage.getItem(e);return void 0===t||null===t?o:(o=null===o?{}:JSON.parse(o),""===t?o:o.getProperty(t))},setLocal:(e,t,o)=>{e=om.prefix+e;let r=localStorage.getItem(e);void 0!==t&&null!==t?(r=null===r?{}:JSON.parse(r),""===t?r=o:r.setProperty(t,o),localStorage.setItem(e,JSON.stringify(r))):localStorage.setItem(e,o)},removeLocal:(e,t)=>{if(e=om.prefix+e,void 0!==t&&null!==t&&""!==t){let o=localStorage.getItem(e);(o=null===o?{}:JSON.parse(o)).deleteProperty(t),localStorage.setItem(e,JSON.stringify(o))}else localStorage.removeItem(e)}};om.lang=om.langs.ru,angular.module("om",["ngResource"]).provider("$om",function(){var e=this;this.url="https://api.om.ua/",this.resources={},this.actions={get:{method:"GET"},list:{method:"GET",isArray:!0},post:{method:"POST"},put:{method:"PUT"},delete:{method:"DELETE"}},this.$get=["$resource",t=>o=>{if(void 0!==e[o])return e[o];switch(o){case"accounts":e[o]=t(e.url+"accounts/:id",{id:"@id"},e.actions);break;case"sessions":e[o]=t(e.url+"sessions/:session",{},e.actions);break;case"tokens":e[o]=t(e.url+"tokens/:token",{},e.actions);break;case"operations":e[o]=t(e.url+"operations/:id",{id:"@id"},e.actions);break;case"services":e[o]=t(e.url+"services/:id",{id:"@id"},e.actions)}return void 0!==e[o]?e[o]:void 0}]});var app=angular.module("app",["om","ngMaterial","ngMessages","ngRoute"]);app.config(["$mdThemingProvider","$mdIconProvider","$mdAriaProvider","$httpProvider","$locationProvider","$routeProvider",(e,o,t,s,a,i)=>{e.theme("default").primaryPalette("blue",{default:"700"}),o.defaultFontSet("FontAwesome").fontSet("fa","FontAwesome"),t.disableWarnings(),s.defaults.withCredentials=!0,a.html5Mode({enabled:!0,requireBase:!1}),i.when("/",{templateUrl:"/templates/root.html"}).when("/signup",{templateUrl:"/templates/signup.html"}).when("/signin",{templateUrl:"/templates/signin.html"}).when("/settings",{templateUrl:"/templates/settings.html"}).when("/auth",{templateUrl:"/templates/auth.html"}).otherwise({redirectTo:"/"})}]),app.directive("passwords",()=>({require:"ngModel",link:(e,o,t,s)=>{s.$validators.passwords=((o,t)=>!(!s.$isEmpty(o)&&void 0!==e.tmp.password1)||e.tmp.password1===o)}})),app.run(["$rootScope","$location","$om",(e,o,t)=>{let s=o.path(),a=om.getLocal("id");if("/auth"===s){let s=JSON.parse(atob(location.hash.substr(1)));e.redirect={origin:s.origin,back:s.origin+s.base+"/auth/#",url:s.origin+s.path},a?t("token").post({session:om.getLocal("session"),origin:s.origin}).$promise.then(o=>{location.href=e.redirect.back+btoa(JSON.stringify({id:o.id,token:o.token,url:e.redirect.url}))}):o.url("/signin")}a?-1!==["/signup","/signin"].indexOf(s)&&o.path("/"):"/settings"===s&&o.path("/")}]),app.controller("controller",["$rootScope","$scope","$location","$http","$mdMedia","$mdSidenav","$mdToast","$om",(e,o,t,s,a,i,n,r)=>{o.isGt=(()=>a("gt-xs")),o.route=(e=>t.path()==e),o.toggleSidenav=(()=>{i("left").toggle()}),o.message=((e,o)=>{n.show(n.simple().content(e).hideDelay(void 0!==o?o:om.toastDelay).position(om.toastPosition))}),o.error=(e=>{console.log(e),void 0!==e.data&&void 0!==e.data.code&&o.message(om.codes[e.data.code]),o.loading=!1}),o.loading=!1,o.tmp={},o.account={},o.id=om.getLocal("id"),o.id&&(o.session=om.getLocal("session"),o.token=om.getLocal("token"),o.account=om.getLocal("account",""),s.defaults.headers.common["X-Auth-Token"]=o.token,r("accounts").get({id:o.id}).$promise.then(e=>{o.account=e,om.setLocal("account","",{id:e.id,gravatar:e.gravatar})}).catch(o.error),r("operations").list().$promise.then(e=>{o.operations=e}).catch(o.error)),o.change=(()=>{o.tmp.password1===o.tmp.password2?om.sha(o.tmp.password1).then(e=>{void 0===o.tmp.password?o.account.password=e:o.account.newpassword=e}):(delete o.account.password,delete o.account.newpassword),void 0!==o.tmp.password&&om.sha(o.tmp.password).then(e=>{o.account.password=e})}),o.signup=(()=>{o.loading=!0,o.message(om.lang.signup_in_progress,!1),r("accounts").post(o.account).$promise.then(()=>{o.account.identity=o.account.email,o.signin()}).catch(o.error)}),o.signin=(()=>{o.loading=!0,o.message(om.lang.signin_in_progress,!1),r("sessions").post({identity:o.account.identity,password:o.account.password}).$promise.then(e=>(o.tmp={},o.id=e.id,o.session=e.session,om.setLocal("id",null,e.id),om.setLocal("session",null,e.session),r("tokens").post({session:o.session,origin:location.origin}).$promise)).then(e=>(o.token=e.token,om.setLocal("token",null,e.token),s.defaults.headers.common["X-Auth-Token"]=e.token,r("accounts").get({id:o.id}).$promise)).then(s=>(o.account=s,om.setLocal("account","",{id:s.id,gravatar:s.gravatar}),void 0===e.redirect?(t.path("/"),o.loading=!1,o.message(om.lang.signin_success+" "+(s.firstname||s.username||"")+" "+s.email),r("operations").list().$promise):r("tokens").post({session:o.session,origin:e.redirect.origin}).$promise)).then(t=>{void 0===e.redirect?o.operations=t:location.href=e.redirect.back+btoa(JSON.stringify({id:t.id,token:t.token,url:e.redirect.url}))}).catch(o.error)}),o.signout=(()=>{o.loading=!0,o.message(om.lang.signout_in_progress,!1),r("sessions").delete({session:o.session}).$promise.then(()=>{o.tmp={},o.account={},delete o.id,delete o.session,delete o.token,delete o.operations,om.removeLocal("id"),om.removeLocal("session"),om.removeLocal("token"),om.removeLocal("account"),o.loading=!1,o.message(om.lang.signout_success)}).catch(o.error)}),o.settings=(()=>{o.loading=!0,o.message(om.lang.saving,!1),r("accounts").put(o.account).$promise.then(e=>{o.tmp={},o.account=e,om.setLocal("account","",{id:e.id,gravatar:e.gravatar}),t.path("/"),o.loading=!1,o.message(om.lang.saved)}).catch(o.error)})}]);